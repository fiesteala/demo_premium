<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Boda de Ana & Carlos</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Montserrat:wght@300;400;600&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <!-- Iconos (Lucide & FontAwesome) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Configuración de Colores -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        weddingGold: '#D4AF37',
                        weddingSage: '#8da399',
                        weddingCream: '#F9F7F2',
                        weddingDark: '#2C3E50',
                    },
                    fontFamily: {
                        script: ['"Great Vibes"', 'cursive'],
                        serif: ['"Playfair Display"', 'serif'],
                        sans: ['"Montserrat"', 'sans-serif'],
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'fade-in-up': 'fadeInUp 1s ease-out forwards',
                        'bounce-gentle': 'bounceGentle 2s infinite',
                        'pulse-slow': 'pulseSlow 3s infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        bounceGentle: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        },
                        pulseSlow: {
                            '0%, 100%': { transform: 'scale(1)', opacity: '1' },
                            '50%': { transform: 'scale(1.05)', opacity: '0.9' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Estilos generales */
        body {
            background-color: #F9F7F2;
        }
        
        .scroll-hidden::-webkit-scrollbar {
            display: none;
        }
        .scroll-hidden {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
        }

        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s ease-out;
        }
        .reveal.active {
            opacity: 1;
            transform: translateY(0);
        }

        .polaroid {
            background: white;
            padding: 10px 10px 35px 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transform: rotate(-2deg);
            transition: transform 0.3s ease;
        }
        .polaroid:nth-child(even) { transform: rotate(2deg); }
        @media (min-width: 768px) {
            .polaroid:hover { transform: scale(1.05) rotate(0deg); z-index: 10; }
        }

        .music-btn-pulse {
            box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.7);
            animation: pulse-gold 2s infinite;
        }
        @keyframes pulse-gold {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(212, 175, 55, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(212, 175, 55, 0); }
        }

        /* --- ESTILOS DEL SOBRE INTERACTIVO RESPONSIVO --- */
        #welcome-overlay {
            position: fixed;
            inset: 0;
            background-color: #F9F7F2; 
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 1s ease-out, visibility 1s;
        }
        #welcome-overlay.hidden-overlay {
            opacity: 0;
            visibility: hidden;
        }

        /* Contenedor del sobre Responsive */
        .envelope-wrapper {
            position: relative;
            /* Ocupa gran parte de la pantalla pero mantiene formato sobre (3:2) */
            width: 85vw; 
            max-width: 550px; 
            aspect-ratio: 3/2; 
            cursor: pointer;
            perspective: 1000px;
            transition: transform 0.5s ease;
            margin-bottom: 30px; /* Espacio para el texto de abajo */
        }
        .envelope-wrapper:hover {
            transform: scale(1.02);
        }

        /* Cuerpo del sobre */
        .envelope {
            position: relative;
            width: 100%;
            height: 100%;
            background-color: #d6c6b8; /* Fondo oscuro interior */
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            border-radius: 8px;
            overflow: visible; 
        }

        /* Solapa superior (Triángulo) */
        .flap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #eaddcf;
            /* Triángulo superior invertido */
            clip-path: polygon(0 0, 50% 50%, 100% 0);
            transform-origin: top;
            transition: transform 0.6s ease-in-out 0.2s, z-index 0.6s;
            z-index: 30; 
            border-radius: 8px;
        }
        /* Sombra solapa */
        .flap::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(0,0,0,0.05), transparent);
            clip-path: polygon(0 0, 50% 50%, 100% 0);
        }

        /* Bolsillo frontal (Frontal del sobre) */
        .pocket {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #f2e6dc; 
            /* Recorte en V para mostrar el interior */
            clip-path: polygon(0 0, 50% 55%, 100% 0, 100% 100%, 0 100%);
            z-index: 20;
            border-radius: 8px;
            /* Sombra sutil para dar volumen a las solapas laterales simuladas */
            background: linear-gradient(180deg, rgba(0,0,0,0.03) 0%, transparent 10%), #f2e6dc;
        }

        /* Carta interior */
        .letter {
            position: absolute;
            bottom: 5px;
            left: 5%;
            width: 90%;
            height: 90%;
            background: white;
            border-radius: 4px;
            z-index: 10;
            transition: transform 0.8s ease-out 0.6s; /* Delay mayor para esperar solapa */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.05);
            padding: 5%;
        }
        /* Texto responsivo en la carta */
        .letter h2 {
            font-family: 'Great Vibes', cursive;
            font-size: clamp(1.5rem, 5vw, 2.5rem); /* Escala con la pantalla */
            color: #D4AF37;
        }
        .letter p {
            font-family: 'Playfair Display', serif;
            font-size: clamp(0.8rem, 3vw, 1rem);
            color: #2C3E50;
        }

        /* Sello de lacre */
        .wax-seal {
            position: absolute;
            top: 48%; 
            left: 50%;
            transform: translate(-50%, -50%);
            width: clamp(50px, 12vw, 70px); /* Sello escalable */
            height: clamp(50px, 12vw, 70px);
            background: radial-gradient(circle at 30% 30%, #ffd700, #D4AF37, #b8860b);
            border-radius: 50%;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3), inset 0 2px 5px rgba(255,255,255,0.4);
            z-index: 40; 
            display: flex;
            align-items: center;
            justify-content: center;
            color: #8b6914;
            font-family: 'Great Vibes', cursive;
            font-size: clamp(1rem, 4vw, 1.5rem);
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }
        .wax-seal::after {
            content: '';
            position: absolute;
            width: 80%;
            height: 80%;
            border: 2px dashed rgba(139, 105, 20, 0.5);
            border-radius: 50%;
        }

        /* ANIMACIONES DE APERTURA */
        .envelope-wrapper.open .flap {
            transform: rotateX(180deg);
            z-index: 5; 
        }
        .envelope-wrapper.open .wax-seal {
            opacity: 0;
            pointer-events: none;
        }
        .envelope-wrapper.open .letter {
            transform: translateY(-40%); /* Sale el 40% hacia arriba */
            z-index: 25; 
        }
        
        .pulse-text {
            position: absolute;
            bottom: -50px;
            width: 100%;
            text-align: center;
            color: #8da399;
            font-size: 1rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            animation: pulseSlow 2s infinite;
        }

        /* ADMIN PANEL STYLES */
        #admin-modal {
            transition: opacity 0.3s ease;
        }
        /* Ajuste de ancho para vista de lista */
        #admin-container {
            transition: max-width 0.3s ease;
        }
        .admin-wide {
            max-width: 600px !important;
        }
        
        .admin-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            outline: none;
        }
        .admin-input:focus {
            border-color: #D4AF37;
            box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.2);
        }
        
        /* Tab Styles */
        .admin-tab {
            padding: 8px 16px;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            color: #6b7280;
        }
        .admin-tab.active {
            border-bottom-color: #D4AF37;
            color: #D4AF37;
        }

        /* LOGO STYLES */
        .logo-container { width: 100%; max-width: 180px; margin: 0 auto; display: block; cursor: pointer; }
        .cursor-icon, .spark-group, .dot-icon { transform-origin: center; transform-box: fill-box; transition: transform 0.5s ease; }
        .animating .cursor-icon { animation: click-press 0.6s ease-in-out forwards; }
        .animating .spark-group { animation: confetti-pop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        .animating .dot-icon { animation: dot-beat 0.6s ease-in-out forwards; }
        @keyframes click-press { 0%, 100% { transform: scale(1) rotate(0deg); } 50% { transform: scale(0.92) rotate(-2deg); } }
        @keyframes confetti-pop { 0% { transform: scale(1); } 50% { transform: scale(1.35); } 100% { transform: scale(1); } }
        @keyframes dot-beat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.4); fill: #2563eb; } }
    </style>
</head>
<body class="font-sans text-weddingDark antialiased overflow-hidden" id="main-body">

    <!-- SOBRE INTERACTIVO RESPONSIVO (BIENVENIDA) -->
    <div id="welcome-overlay">
        
        <div class="envelope-wrapper" id="envelope">
            <div class="envelope">
                <div class="letter">
                    <h2 class="mb-1" id="envelope-names">Ana & Carlos</h2>
                    <p>14 . 10 . 2026</p>
                    <!-- ETIQUETA OCULTA POR DEFECTO -->
                    <p id="envelope-tickets" class="text-[0.7rem] md:text-sm text-weddingGold font-bold mt-1 hidden"></p>
                    <p id="guest-greeting" class="text-[0.6rem] md:text-xs text-gray-400 mt-2 uppercase tracking-widest">Toca para abrir</p>
                </div>
                <!-- Bolsillo con CSS clip-path (Responsivo) -->
                <div class="pocket"></div>
                <!-- Solapa móvil -->
                <div class="flap"></div>
                <!-- Sello clicable -->
                <div class="wax-seal animate-pulse-slow">A&C</div>
            </div>
            
            <div class="pulse-text" id="open-text">Abrir Invitación</div>
        </div>

    </div>

    <!-- Reproductor de Música (Botón Flotante) -->
    <div class="fixed top-4 right-4 z-50">
        <button id="musicToggle" class="bg-weddingGold text-white w-12 h-12 flex items-center justify-center rounded-full shadow-lg music-btn-pulse focus:outline-none transition-all hover:bg-yellow-600 active:scale-90 cursor-pointer opacity-0 transition-opacity duration-1000" style="opacity: 0;">
            <i id="musicIcon" class="fas fa-music text-lg"></i>
        </button>
        <audio id="weddingMusic" preload="auto" loop>
            <source src="https://assets.mixkit.co/music/preview/mixkit-love-and-wedding-piano-235.mp3" type="audio/mp3">
        </audio>
    </div>

    <!-- PANEL DE ADMINISTRACIÓN (OCULTO) -->
    <div id="admin-modal" class="fixed inset-0 z-[100] bg-black/60 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div id="admin-container" class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-sm relative flex flex-col max-h-[90vh]">
            <button id="closeAdmin" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 z-10">
                <i class="fas fa-times"></i>
            </button>
            
            <h3 class="font-serif text-2xl text-weddingGold mb-2 text-center">Panel de Novios</h3>
            
            <!-- Vista 1: Login -->
            <div id="admin-login-view">
                <p class="text-sm text-gray-500 mb-4 text-center">Ingresa la contraseña para gestionar tu boda</p>
                <input type="password" id="admin-pass" class="admin-input" placeholder="Contraseña">
                <button onclick="checkAdminPass()" class="w-full bg-weddingDark text-white py-2 rounded-lg hover:bg-gray-800 transition">Entrar</button>
                <p id="login-error" class="text-red-500 text-xs mt-2 hidden text-center">Contraseña incorrecta</p>
            </div>

            <!-- Vista 2: Dashboard con Pestañas -->
            <div id="admin-dashboard-view" class="hidden flex-1 flex flex-col overflow-hidden">
                
                <!-- Navegación Tabs -->
                <div class="flex border-b border-gray-200 mb-4">
                    <button onclick="switchTab('create')" id="tab-create" class="admin-tab active flex-1 text-center">Nueva Invitación</button>
                    <button onclick="switchTab('list')" id="tab-list" class="admin-tab flex-1 text-center">Lista Invitados</button>
                </div>

                <!-- Tab: Crear -->
                <div id="view-create" class="flex-1 overflow-y-auto">
                    <p class="text-sm text-gray-500 mb-4 text-center">Genera enlace para WhatsApp y guarda en la lista</p>
                    
                    <label class="block text-xs font-bold text-gray-600 mb-1">Nombre del Invitado(s)</label>
                    <input type="text" id="guest-name-input" class="admin-input" placeholder="Ej. Familia Pérez">
                    
                    <label class="block text-xs font-bold text-gray-600 mb-1">Pases Asignados</label>
                    <select id="guest-tickets-input" class="admin-input">
                        <option value="1">1 Persona</option>
                        <option value="2" selected>2 Personas</option>
                        <option value="3">3 Personas</option>
                        <option value="4">4 Personas</option>
                        <option value="5">5 Personas</option>
                        <option value="6">6 Personas</option>
                    </select>

                    <label class="block text-xs font-bold text-gray-600 mb-1">WhatsApp del Invitado</label>
                    <input type="tel" id="guest-phone-input" class="admin-input" placeholder="Ej. 525512345678">

                    <button onclick="generateAndSend()" class="w-full bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 transition font-bold shadow-md mt-2 flex items-center justify-center gap-2">
                        <i class="fab fa-whatsapp text-xl"></i> Enviar & Guardar
                    </button>
                </div>

                <!-- Tab: Lista -->
                <div id="view-list" class="hidden flex-1 flex flex-col overflow-hidden">
                    <!-- Stats -->
                    <div class="flex justify-between text-xs text-gray-500 mb-2 px-1">
                        <span>Total: <b id="total-guests">0</b> Invitaciones</span>
                        <span>Pases: <b id="total-pax">0</b> Personas</span>
                    </div>

                    <!-- Tabla Scrollable -->
                    <div class="flex-1 overflow-y-auto border border-gray-100 rounded-lg mb-4 bg-gray-50">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-gray-100 text-gray-600 sticky top-0">
                                <tr>
                                    <th class="p-2 font-bold">Nombre</th>
                                    <th class="p-2 font-bold text-center">Pax</th>
                                    <th class="p-2 font-bold text-right">Acción</th>
                                </tr>
                            </thead>
                            <tbody id="guest-list-body" class="divide-y divide-gray-200">
                                <!-- Filas generadas por JS -->
                            </tbody>
                        </table>
                        <div id="empty-state" class="p-8 text-center text-gray-400 hidden">
                            <i class="fas fa-users text-2xl mb-2"></i>
                            <p class="text-xs">Aún no hay invitados</p>
                        </div>
                    </div>

                    <!-- Botones Exportar -->
                    <div class="grid grid-cols-2 gap-2 mt-auto pt-2 border-t border-gray-100">
                        <button onclick="exportToExcel()" class="bg-green-600 text-white py-2 rounded text-xs flex items-center justify-center gap-1 hover:bg-green-700">
                            <i class="fas fa-file-excel"></i> Exportar Excel
                        </button>
                        <button onclick="exportToWord()" class="bg-blue-600 text-white py-2 rounded text-xs flex items-center justify-center gap-1 hover:bg-blue-700">
                            <i class="fas fa-file-word"></i> Exportar Word
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- HEADER / PORTADA -->
    <header class="relative h-screen min-h-[600px] flex flex-col justify-center items-center text-center px-4 overflow-hidden">
        <!-- Imagen de fondo -->
        <div class="absolute inset-0 z-0">
            <img src="https://images.unsplash.com/photo-1606800052052-a08af7148866?auto=format&fit=crop&w=1920&q=80" alt="Fondo Boda" class="w-full h-full object-cover opacity-90 brightness-50">
        </div>
        
        <div class="relative z-10 text-white animate-fade-in-up w-full max-w-4xl mx-auto">
            <p id="header-greeting" class="text-sm md:text-lg tracking-[0.3em] uppercase mb-4 md:mb-6">¡Nos Casamos!</p>
            <h1 class="font-script text-6xl sm:text-7xl md:text-8xl lg:text-9xl mb-4 text-weddingGold drop-shadow-lg leading-tight">
                Ana <br class="md:hidden"> <span class="text-white text-4xl md:text-6xl align-middle">&</span> Carlos
            </h1>
            <div class="w-16 md:w-24 h-1 bg-weddingGold mx-auto my-4 md:my-6"></div>
            <p class="font-serif text-xl md:text-3xl italic">14 de Octubre, 2026</p>
            
            <!-- Etiqueta de Pases (OCULTA POR DEFECTO) -->
            <div id="tickets-badge" class="hidden mt-6 bg-white/20 backdrop-blur-md border border-white/40 rounded-full px-6 py-2 inline-block">
                <p class="text-sm md:text-base font-serif"><i class="fas fa-ticket-alt mr-2 text-weddingGold"></i> <span id="tickets-count"></span> Lugares Reservados</p>
            </div>
        </div>
        <div class="absolute bottom-8 z-10 animate-float">
            <i class="fas fa-chevron-down text-white text-xl md:text-2xl opacity-70"></i>
        </div>
    </header>

    <!-- CUENTA REGRESIVA -->
    <section class="py-12 bg-weddingCream text-center reveal">
        <div class="container mx-auto px-4">
            <h2 class="font-serif text-2xl md:text-3xl text-weddingSage mb-6 md:mb-8">Falta muy poco</h2>
            <div class="flex flex-wrap justify-center gap-3 md:gap-8 font-serif text-weddingDark">
                <div class="bg-white p-3 md:p-4 rounded-lg shadow-sm w-20 md:w-24">
                    <span id="days" class="block text-2xl md:text-3xl font-bold text-weddingGold">00</span>
                    <span class="text-[10px] md:text-xs uppercase tracking-widest">Días</span>
                </div>
                <div class="bg-white p-3 md:p-4 rounded-lg shadow-sm w-20 md:w-24">
                    <span id="hours" class="block text-2xl md:text-3xl font-bold text-weddingGold">00</span>
                    <span class="text-[10px] md:text-xs uppercase tracking-widest">Hs</span>
                </div>
                <div class="bg-white p-3 md:p-4 rounded-lg shadow-sm w-20 md:w-24">
                    <span id="minutes" class="block text-2xl md:text-3xl font-bold text-weddingGold">00</span>
                    <span class="text-[10px] md:text-xs uppercase tracking-widest">Min</span>
                </div>
                <div class="bg-white p-3 md:p-4 rounded-lg shadow-sm w-20 md:w-24">
                    <span id="seconds" class="block text-2xl md:text-3xl font-bold text-weddingGold">00</span>
                    <span class="text-[10px] md:text-xs uppercase tracking-widest">Seg</span>
                </div>
            </div>
        </div>
    </section>

    <!-- MENSAJE -->
    <section class="py-12 md:py-16 px-4 md:px-6 bg-white text-center reveal">
        <div class="max-w-2xl mx-auto">
            <i class="fas fa-quote-left text-2xl md:text-3xl text-weddingSage mb-4 opacity-50"></i>
            <p class="font-serif text-lg md:text-2xl text-gray-600 leading-relaxed italic mb-6">
                "El amor no se trata de mirar el uno al otro, sino de mirar juntos en la misma dirección. Queremos que seas parte del comienzo de nuestra mejor aventura."
            </p>
            <p class="font-sans uppercase tracking-widest text-xs md:text-sm text-weddingGold mb-8">Con la bendición de nuestros padres</p>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-8 md:gap-8 text-sm md:text-base">
                <div class="pb-4 sm:pb-0 border-b sm:border-b-0 border-gray-100">
                    <h3 class="font-bold text-weddingDark mb-2 font-serif text-lg">Padres de la Novia</h3>
                    <p class="text-gray-500">Roberto Gómez</p>
                    <p class="text-gray-500">María Fernández</p>
                </div>
                <div>
                    <h3 class="font-bold text-weddingDark mb-2 font-serif text-lg">Padres del Novio</h3>
                    <p class="text-gray-500">Luis Martínez</p>
                    <p class="text-gray-500">Elena Ruiz</p>
                </div>
            </div>
        </div>
    </section>

    <!-- PADRINOS -->
    <section class="py-12 md:py-16 bg-weddingCream reveal">
        <div class="container mx-auto px-4 text-center">
            <h2 class="font-script text-4xl md:text-5xl text-weddingSage mb-2">Nuestros Padrinos</h2>
            <p class="mb-8 text-gray-500 text-sm md:text-base">Testigos de nuestro amor</p>
            
            <div class="flex overflow-x-auto gap-4 md:gap-6 pb-8 px-4 scroll-hidden snap-x snap-mandatory justify-start md:justify-center">
                <div class="min-w-[160px] md:min-w-[200px] snap-center flex flex-col items-center">
                    <div class="w-20 h-20 md:w-24 md:h-24 rounded-full bg-gray-300 mb-3 overflow-hidden border-2 border-weddingGold shadow-sm">
                         <img src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?auto=format&fit=crop&w=200&q=80" class="w-full h-full object-cover">
                    </div>
                    <h4 class="font-serif font-bold text-lg">Jorge L.</h4>
                    <p class="text-[10px] md:text-xs uppercase text-gray-500 tracking-wider">Padrino de Anillos</p>
                </div>
                 <div class="min-w-[160px] md:min-w-[200px] snap-center flex flex-col items-center">
                    <div class="w-20 h-20 md:w-24 md:h-24 rounded-full bg-gray-300 mb-3 overflow-hidden border-2 border-weddingGold shadow-sm">
                         <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?auto=format&fit=crop&w=200&q=80" class="w-full h-full object-cover">
                    </div>
                    <h4 class="font-serif font-bold text-lg">Sofia M.</h4>
                    <p class="text-[10px] md:text-xs uppercase text-gray-500 tracking-wider">Madrina de Lazo</p>
                </div>
                 <div class="min-w-[160px] md:min-w-[200px] snap-center flex flex-col items-center">
                    <div class="w-20 h-20 md:w-24 md:h-24 rounded-full bg-gray-300 mb-3 overflow-hidden border-2 border-weddingGold shadow-sm">
                         <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?auto=format&fit=crop&w=200&q=80" class="w-full h-full object-cover">
                    </div>
                    <h4 class="font-serif font-bold text-lg">Pedro R.</h4>
                    <p class="text-[10px] md:text-xs uppercase text-gray-500 tracking-wider">Padrino de Velación</p>
                </div>
            </div>
            <p class="md:hidden text-xs text-gray-400 mt-2 animate-pulse"><i class="fas fa-arrows-left-right mr-1"></i> Desliza para ver más</p>
        </div>
    </section>

    <!-- DONDE & CUANDO -->
    <section class="py-12 md:py-16 relative">
        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
        <div class="container mx-auto px-4 max-w-4xl relative z-10">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
                <div class="glass-panel p-6 md:p-8 rounded-xl text-center reveal border-t-4 border-weddingSage transform transition hover:-translate-y-1 duration-300">
                    <div class="text-3xl md:text-4xl text-weddingSage mb-4"><i class="fas fa-church"></i></div>
                    <h3 class="font-serif text-xl md:text-2xl font-bold mb-2">Ceremonia Religiosa</h3>
                    <p class="text-lg font-bold text-weddingGold">4:00 PM</p>
                    <p class="text-gray-600 mb-6 text-sm md:text-base">Parroquia San Miguel Arcángel</p>
                    <button onclick="window.open('https://maps.google.com', '_blank')" class="w-full md:w-auto bg-gray-50 hover:bg-gray-100 text-gray-800 font-semibold py-3 px-6 rounded-lg text-sm transition shadow-sm border border-gray-200">
                        <i class="fas fa-map-marker-alt mr-2 text-red-500"></i> Ver Mapa
                    </button>
                </div>

                <div class="glass-panel p-6 md:p-8 rounded-xl text-center reveal border-t-4 border-weddingGold transform transition hover:-translate-y-1 duration-300">
                    <div class="text-3xl md:text-4xl text-weddingGold mb-4"><i class="fas fa-glass-cheers"></i></div>
                    <h3 class="font-serif text-xl md:text-2xl font-bold mb-2">Recepción & Fiesta</h3>
                    <p class="text-lg font-bold text-weddingGold">6:30 PM</p>
                    <p class="text-gray-600 mb-6 text-sm md:text-base">Hacienda Los Encinos</p>
                    <button onclick="window.open('https://maps.google.com', '_blank')" class="w-full md:w-auto bg-gray-50 hover:bg-gray-100 text-gray-800 font-semibold py-3 px-6 rounded-lg text-sm transition shadow-sm border border-gray-200">
                        <i class="fas fa-location-arrow mr-2 text-blue-500"></i> Cómo llegar
                    </button>
                </div>
            </div>

            <div class="text-center mt-10 md:mt-12 reveal">
                <button onclick="addToCalendar()" class="w-full md:w-auto bg-weddingDark text-white px-8 py-4 rounded-full hover:bg-gray-800 transition shadow-lg transform active:scale-95">
                    <i class="far fa-calendar-plus mr-2"></i> Agendar en mi Calendario
                </button>
            </div>
        </div>
    </section>

    <!-- GALERÍA DINÁMICA -->
    <section class="py-12 md:py-16 bg-weddingSage/10 overflow-hidden reveal">
        <div class="text-center mb-8 md:mb-10 px-4">
            <h2 class="font-script text-4xl md:text-5xl text-weddingSage">Nuestra Historia</h2>
            <p class="text-gray-500 mt-2 text-sm md:text-base">Momentos inolvidables</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-4 auto-rows-auto md:auto-rows-[300px] gap-6 px-6 max-w-6xl mx-auto">
            <div class="polaroid md:col-span-2 md:row-span-2 rotate-[-1deg] md:rotate-[-2deg]">
                <div class="flex flex-col h-full">
                    <img src="https://images.unsplash.com/photo-1519741497674-611481863552?auto=format&fit=crop&w=800&q=80" class="w-full h-64 md:h-full object-cover flex-grow rounded-sm shadow-inner grayscale hover:grayscale-0 transition duration-500">
                    <div class="text-center font-script text-2xl text-gray-600 mt-3">La Gran Fiesta</div>
                </div>
            </div>
            <div class="polaroid md:row-span-2 rotate-[1deg]">
                <div class="flex flex-col h-full">
                    <img src="https://images.unsplash.com/photo-1515934751635-c81c6bc9a2d8?auto=format&fit=crop&w=400&q=80" class="w-full h-80 md:h-full object-cover flex-grow rounded-sm shadow-inner grayscale hover:grayscale-0 transition duration-500">
                    <div class="text-center font-script text-xl text-gray-600 mt-3">El Sí</div>
                </div>
            </div>
            <div class="polaroid rotate-[-1deg]">
                <div class="flex flex-col h-full">
                    <img src="https://images.unsplash.com/photo-1469334031218-e382a71b716b?auto=format&fit=crop&w=400&q=80" class="w-full h-64 md:h-full object-cover flex-grow rounded-sm shadow-inner grayscale hover:grayscale-0 transition duration-500">
                    <div class="text-center font-script text-xl text-gray-600 mt-3">Viajes</div>
                </div>
            </div>
             <div class="polaroid rotate-[1deg] md:rotate-[2deg]">
                <div class="flex flex-col h-full">
                    <img src="https://images.unsplash.com/photo-1621621667797-e06afc217fb0?auto=format&fit=crop&w=400&q=80" class="w-full h-64 md:h-full object-cover flex-grow rounded-sm shadow-inner grayscale hover:grayscale-0 transition duration-500">
                    <div class="text-center font-script text-xl text-gray-600 mt-3">Nosotros</div>
                </div>
            </div>
            <div class="polaroid md:col-span-2 rotate-[-1deg]">
                <div class="flex flex-col h-full">
                    <img src="https://images.unsplash.com/photo-1510076857177-7470076d4098?auto=format&fit=crop&w=800&q=80" class="w-full h-56 md:h-full object-cover flex-grow rounded-sm shadow-inner grayscale hover:grayscale-0 transition duration-500">
                    <div class="text-center font-script text-xl text-gray-600 mt-3">¡Save the Date!</div>
                </div>
            </div>
            <div class="polaroid md:row-span-2 rotate-[1deg] md:col-start-4 md:row-start-2">
                <div class="flex flex-col h-full">
                    <img src="https://images.unsplash.com/photo-1583939003579-730e3918a45a?auto=format&fit=crop&w=400&q=80" class="w-full h-80 md:h-full object-cover flex-grow rounded-sm shadow-inner grayscale hover:grayscale-0 transition duration-500">
                    <div class="text-center font-script text-xl text-gray-600 mt-3">Amor Eterno</div>
                </div>
            </div>
        </div>
    </section>

    <!-- CÓDIGO DE VESTIMENTA & REGALOS -->
    <section class="py-12 md:py-16 px-4 bg-white text-center reveal">
        <div class="max-w-3xl mx-auto">
            <h2 class="font-serif text-2xl md:text-3xl mb-8 md:mb-10 text-weddingDark">Detalles Importantes</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-10">
                <div class="flex flex-col items-center p-4 rounded-lg bg-gray-50 md:bg-transparent">
                    <div class="w-14 h-14 md:w-16 md:h-16 bg-weddingCream rounded-full flex items-center justify-center text-xl md:text-2xl text-weddingSage mb-4 shadow-sm">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <h3 class="font-bold uppercase tracking-widest mb-2 text-sm md:text-base">Código de Vestimenta</h3>
                    <p class="font-serif text-lg md:text-xl italic text-weddingGold mb-2">Formal / Etiqueta Rigurosa</p>
                    <p class="text-xs md:text-sm text-gray-500 max-w-xs leading-relaxed">Ellas: Vestido largo.<br>Ellos: Traje oscuro o Smoking.</p>
                </div>
                <div class="flex flex-col items-center p-4 rounded-lg bg-gray-50 md:bg-transparent">
                    <div class="w-14 h-14 md:w-16 md:h-16 bg-weddingCream rounded-full flex items-center justify-center text-xl md:text-2xl text-weddingSage mb-4 shadow-sm">
                        <i class="fas fa-gift"></i>
                    </div>
                    <h3 class="font-bold uppercase tracking-widest mb-2 text-sm md:text-base">Mesa de Regalos</h3>
                    <p class="text-gray-500 text-xs md:text-sm max-w-xs mb-3">Tu presencia es nuestro mejor regalo, pero si deseas tener un detalle con nosotros:</p>
                    <div class="text-xs md:text-sm font-semibold text-weddingDark bg-white border border-gray-200 px-4 py-2 rounded-full shadow-sm">
                        <i class="fas fa-envelope mr-2 text-weddingGold"></i> Lluvia de Sobres
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- RSVP -->
    <section class="py-16 md:py-20 bg-weddingDark text-white text-center relative overflow-hidden reveal">
        <div class="absolute top-0 left-0 w-40 h-40 md:w-64 md:h-64 bg-white opacity-5 rounded-full -translate-x-1/2 -translate-y-1/2"></div>
        <div class="absolute bottom-0 right-0 w-60 h-60 md:w-96 md:h-96 bg-weddingGold opacity-10 rounded-full translate-x-1/3 translate-y-1/3"></div>

        <div class="container mx-auto px-4 relative z-10">
            <h2 class="font-script text-4xl md:text-6xl text-weddingGold mb-4 md:mb-6">Confirmar Asistencia</h2>
            <p class="mb-8 text-gray-300 max-w-lg mx-auto text-sm md:text-base px-2">Por favor confírmanos tu asistencia antes del 1 de Octubre para poder organizar todo perfectamente.</p>
            
            <button onclick="confirmWhatsApp()" class="w-full md:w-auto bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-8 rounded-full shadow-lg transition transform hover:scale-105 active:scale-95 flex items-center justify-center mx-auto text-base md:text-lg">
                <i class="fab fa-whatsapp text-2xl mr-3"></i>
                Confirmar por WhatsApp
            </button>
            <p class="mt-6 text-[10px] md:text-xs text-gray-400 opacity-60">Al dar clic se abrirá tu chat de WhatsApp con un mensaje listo.</p>
        </div>
    </section>

    <!-- FOOTER -->
    <footer class="bg-gray-900 text-white py-12 text-center text-sm px-4 relative">
        <p class="font-script text-2xl text-weddingGold mb-2">Ana & Carlos</p>
        <p class="text-gray-500 text-xs md:text-sm mb-8">Esperamos verte ahí.</p>
        
        <!-- FIESTEALA BRANDING (Atenuado y clickeable) -->
        <div class="border-t border-gray-800 pt-8 mt-8 flex flex-col items-center opacity-40 hover:opacity-80 transition-opacity">
            <p class="text-[10px] text-gray-500 uppercase tracking-widest mb-4">Diseño Interactivo por</p>
            
            <!-- Logo SVG Animado (Branding) -->
            <div id="fiesteala-logo" class="logo-container mb-4 cursor-pointer" title="Toque 5 veces para acceso admin">
                <svg viewBox="0 0 400 150" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Logo fiesteala.com">
                    <g transform="translate(50, 20)">
                        <path class="cursor-icon" d="M10,10 L30,70 L45,45 L70,30 Z" fill="#2563eb" stroke="white" stroke-width="3" />
                        <g class="spark-group" transform="translate(10, 10)">
                            <path d="M-3,-6 L-6,-12" stroke="#f59e0b" stroke-width="3" stroke-linecap="round" />
                            <path d="M-6,-3 L-12,-6" stroke="#f59e0b" stroke-width="3" stroke-linecap="round" />
                            <path d="M3,-6 L6,-12" stroke="#f59e0b" stroke-width="3" stroke-linecap="round" />
                            <circle cx="-9" cy="-9" r="2" fill="#f59e0b" />
                        </g>
                    </g>
                    <g transform="translate(130, 85)">
                        <text font-family="sans-serif" font-weight="800" font-size="44" fill="#ffffff" letter-spacing="-1">fiesteala</text>
                        <circle class="dot-icon" cx="182" cy="-5" r="4.5" fill="#2563eb" />
                        <text x="188" y="0" font-family="sans-serif" font-weight="400" font-size="24" fill="#2563eb">com</text>
                    </g>
                </svg>
            </div>
            
            <p class="text-[10px] text-gray-500 font-light leading-relaxed">
                &copy; 2026 Fiesteala.com ® Marca Registrada.<br>
                Todos los derechos del diseño y código reservados.
            </p>
        </div>
    </footer>

    <!-- SCRIPTS LÓGICOS CON FIREBASE INTEGRADO -->
    <script type="module">
        // --------------------------------------------------------
        // 1. IMPORTACIÓN Y CONFIGURACIÓN DE FIREBASE (NUBE)
        // --------------------------------------------------------
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, deleteDoc, doc, getDocs, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Variables globales
        let db, auth, appId;
        let globalUser = null;
        let guestList = []; 
        let secretClicks = 0;
        let firebaseInitialized = false;

        // Intentar inicializar Firebase
        try {
            if (typeof __firebase_config !== 'undefined') {
                const firebaseConfig = JSON.parse(__firebase_config);
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                firebaseInitialized = true;
                
                // Iniciar Auth solo si Firebase cargó
                initAuth();
            } else {
                console.warn("Firebase config not found. Running in offline/demo mode.");
            }
        } catch (e) {
            console.error("Firebase init error:", e);
        }

        // --------------------------------------------------------
        // 2. AUTENTICACIÓN Y SINCRONIZACIÓN
        // --------------------------------------------------------
        
        async function initAuth() {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Auth failed:", error);
            }
        };

        if (firebaseInitialized) {
            // Escuchar cambios de autenticación
            onAuthStateChanged(auth, user => {
                globalUser = user;
                if (user) {
                    // Una vez autenticado, verificamos si hay Slug en la URL para cargar datos
                    window.initInvitationLogic();
                    // Conectar a la base de datos en tiempo real
                    setupRealtimeListener();
                }
            });
        }

        // Configurar el "oyente" de la base de datos
        function setupRealtimeListener() {
            if (!db) return;
            // Ruta segura en la nube: /artifacts/{ID_APP}/public/data/invitaciones_boda_guests
            const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'invitaciones_boda_guests');
            
            onSnapshot(colRef, (snapshot) => {
                guestList = [];
                snapshot.forEach(doc => {
                    // Guardar datos + ID del documento para poder borrarlo luego
                    guestList.push({ ...doc.data(), id: doc.id });
                });
                
                // Ordenar por fecha (más reciente primero)
                guestList.sort((a, b) => b.timestamp - a.timestamp);
                
                // Si el panel de admin está abierto, actualizar la vista
                const adminModal = document.getElementById('admin-modal');
                if (adminModal && !adminModal.classList.contains('hidden')) {
                    renderGuestList();
                }
            }, (error) => {
                console.error("Error sincronizando invitados:", error);
            });
        }

        // --------------------------------------------------------
        // 3. FUNCIONES GLOBALES (EXPORTS A WINDOW)
        // --------------------------------------------------------
        
        // --- LÓGICA DE INVITACIÓN (URL LIMPIA CON SLUG) ---
        window.initInvitationLogic = async function() {
            // Obtener el path limpio (sin dominio)
            const path = window.location.pathname;
            // Extraer el último segmento (el nombre slug)
            // Ejemplo: tudominio.com/familia-perez -> "familia-perez"
            const slug = path.split('/').filter(p => p && p !== 'index.html').pop();

            if (slug && globalUser && db) {
                try {
                    // Consultar Firestore por el campo "slug"
                    const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'invitaciones_boda_guests');
                    const q = query(colRef, where("slug", "==", slug));
                    const snapshot = await getDocs(q);

                    if (!snapshot.empty) {
                        const data = snapshot.docs[0].data();
                        
                        // Actualizar UI con datos reales de la base de datos
                        document.getElementById('guest-greeting').innerText = `Hola ${data.name}`;
                        document.getElementById('header-greeting').innerHTML = `¡Hola ${data.name},<br>nos casamos!`;
                        window.guestName = data.name;

                        if (data.tickets) {
                            const badge = document.getElementById('tickets-badge');
                            badge.classList.remove('hidden');
                            document.getElementById('tickets-count').innerText = data.tickets;
                            
                            const envTickets = document.getElementById('envelope-tickets');
                            envTickets.innerText = `${data.tickets} Lugares Reservados`;
                            envTickets.classList.remove('hidden');
                        }
                    } else {
                        console.log("No se encontró invitación para este enlace");
                    }
                } catch (e) {
                    console.error("Error cargando invitación:", e);
                }
            }
        };

        // --- LÓGICA SOBRE ---
        window.openEnvelope = function() {
            const envelope = document.getElementById('envelope');
            const overlay = document.getElementById('welcome-overlay');
            const body = document.getElementById('main-body');
            const musicBtn = document.getElementById('musicToggle');
            const musicIcon = document.getElementById('musicIcon');
            const audio = document.getElementById('weddingMusic');

            envelope.classList.add('open');
            audio.muted = false;
            audio.volume = 1.0;
            audio.play().then(() => {
                window.isPlaying = true;
                musicIcon.classList.remove('fa-music');
                musicIcon.classList.add('fa-pause');
                musicBtn.classList.remove('music-btn-pulse');
            }).catch(e => console.log("Audio autostart prevented"));

            setTimeout(() => {
                overlay.classList.add('hidden-overlay');
                body.classList.remove('overflow-hidden');
                musicBtn.style.opacity = '1';
            }, 1500);
        };

        // --- LÓGICA MÚSICA ---
        window.toggleMusic = function() {
            const musicBtn = document.getElementById('musicToggle');
            const musicIcon = document.getElementById('musicIcon');
            const audio = document.getElementById('weddingMusic');
            
            if (window.isPlaying) {
                audio.pause();
                musicIcon.classList.remove('fa-pause');
                musicIcon.classList.add('fa-music');
                window.isPlaying = false;
            } else {
                audio.muted = false;
                audio.volume = 1.0;
                audio.play();
                musicIcon.classList.remove('fa-music');
                musicIcon.classList.add('fa-pause');
                window.isPlaying = true;
            }
        };

        // --- CUENTA REGRESIVA ---
        window.startTimer = function() {
            const weddingDate = new Date('2026-10-14T16:00:00').getTime();
            setInterval(function() {
                const now = new Date().getTime();
                const distance = weddingDate - now;
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                
                const elDays = document.getElementById("days");
                if(elDays) {
                    elDays.innerText = days < 10 ? '0' + days : days;
                    document.getElementById("hours").innerText = hours < 10 ? '0' + hours : hours;
                    document.getElementById("minutes").innerText = minutes < 10 ? '0' + minutes : minutes;
                    document.getElementById("seconds").innerText = seconds < 10 ? '0' + seconds : seconds;
                }
            }, 1000);
        };

        // --- ANIMACIÓN SCROLL ---
        window.initScrollObserver = function() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('active');
                    }
                });
            }, { threshold: 0.1 });
            document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
        };

        // --- BOTONES PÚBLICOS ---
        window.confirmWhatsApp = function() {
            const phone = "525512345678"; 
            const name = window.guestName ? window.guestName : "un invitado";
            const message = `¡Hola! Soy ${name} y quiero confirmar mi asistencia para la boda de Ana y Carlos.`;
            window.open(`https://wa.me/${phone}?text=${encodeURIComponent(message)}`, '_blank');
        };

        window.addToCalendar = function() {
            const title = "Boda Ana & Carlos";
            const details = "Celebración de nuestra boda religiosa y recepción.";
            const location = "Parroquia San Miguel Arcángel";
            window.open(`https://www.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(title)}&dates=20261014T160000/20261015T020000&details=${encodeURIComponent(details)}&location=${encodeURIComponent(location)}&sf=true&output=xml`, '_blank');
        };

        // --- ACCESO SECRETO (5 CLICKS EN LOGO) ---
        window.setupSecretAccess = function() {
            const logo = document.getElementById('fiesteala-logo');
            if(logo) {
                // Animación visual suave
                function animate() {
                    logo.classList.add('animating');
                    setTimeout(() => {
                        logo.classList.remove('animating');
                        setTimeout(animate, 5000); 
                    }, 600); 
                }
                setTimeout(animate, 1000);

                // Lógica de 5 clicks
                logo.addEventListener('click', () => {
                    secretClicks++;
                    if(secretClicks === 5) {
                        window.toggleAdmin(true);
                        secretClicks = 0; // Reset
                    }
                    // Resetear si deja de clickear por 2 segundos
                    if(window.clickTimer) clearTimeout(window.clickTimer);
                    window.clickTimer = setTimeout(() => { secretClicks = 0; }, 2000);
                });
            }
        };

        // --------------------------------------------------------
        // 4. LÓGICA DEL PANEL DE ADMINISTRACIÓN (FIREBASE)
        // --------------------------------------------------------

        window.toggleAdmin = function(show) {
            const modal = document.getElementById('admin-modal');
            if (show) modal.classList.remove('hidden');
            else modal.classList.add('hidden');
        };

        window.checkAdminPass = function() {
            const pass = document.getElementById('admin-pass').value;
            const errorMsg = document.getElementById('login-error');
            
            if(pass === 'boda2026') {
                document.getElementById('admin-login-view').classList.add('hidden');
                document.getElementById('admin-dashboard-view').classList.remove('hidden');
                // Al entrar exitosamente, renderizar la lista actual
                renderGuestList(); 
            } else {
                errorMsg.classList.remove('hidden');
            }
        };

        window.switchTab = function(tab) {
            const btnCreate = document.getElementById('tab-create');
            const btnList = document.getElementById('tab-list');
            const viewCreate = document.getElementById('view-create');
            const viewList = document.getElementById('view-list');
            const container = document.getElementById('admin-container');

            if (tab === 'create') {
                btnCreate.classList.add('active');
                btnList.classList.remove('active');
                viewCreate.classList.remove('hidden');
                viewList.classList.add('hidden');
                container.classList.remove('admin-wide');
            } else {
                btnList.classList.add('active');
                btnCreate.classList.remove('active');
                viewList.classList.remove('hidden');
                viewCreate.classList.add('hidden');
                container.classList.add('admin-wide');
                renderGuestList();
            }
        };

        // GUARDAR EN FIREBASE (CLOUD) Y GENERAR LINK LIMPIO
        window.generateAndSend = async function() {
            const name = document.getElementById('guest-name-input').value;
            const tickets = document.getElementById('guest-tickets-input').value;
            const phone = document.getElementById('guest-phone-input').value;

            if(!name || !phone) {
                alert("Por favor llena el nombre y el teléfono");
                return;
            }

            // 1. Crear Slug Limpio (sin símbolos)
            // Ejemplo: "Familia Pérez" -> "familia-perez"
            const slug = name.toLowerCase().trim()
                            .replace(/[^\w\s-]/g, '') // Quitar caracteres especiales
                            .replace(/[\s_-]+/g, '-') // Espacios a guiones
                            .replace(/^-+|-+$/g, ''); // Quitar guiones al inicio/final

            if (!slug) {
                alert("El nombre debe contener letras");
                return;
            }

            // 2. Guardar en Firestore (Nube)
            if (globalUser && db) {
                try {
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'invitaciones_boda_guests'), {
                        name: name,
                        slug: slug, // Guardamos el slug para buscarlo después
                        tickets: tickets,
                        phone: phone,
                        date: new Date().toLocaleDateString(),
                        timestamp: Date.now()
                    });

                    // 3. Generar Enlace Limpio: tudominio.com/familia-perez
                    const baseUrl = window.location.origin + window.location.pathname;
                    // Limpiamos la URL base por seguridad
                    let cleanBaseUrl = baseUrl.split('?')[0].split('#')[0];
                    if(cleanBaseUrl.endsWith('index.html')) {
                        // Intentamos quitar index.html para que quede más limpio si el server lo soporta
                        cleanBaseUrl = cleanBaseUrl.replace('index.html', '');
                    }
                    if(!cleanBaseUrl.endsWith('/')) cleanBaseUrl += '/';
                    
                    const finalLink = `${cleanBaseUrl}${slug}`;

                    // 4. WhatsApp (Mensaje limpio sin datos numéricos)
                    const message = `Hola ${name}, nos encantaría que nos acompañes en nuestra boda. Por favor revisa tu invitación aquí: ${finalLink}`;
                    window.open(`https://wa.me/${phone}?text=${encodeURIComponent(message)}`, '_blank');

                    // 5. Limpiar
                    document.getElementById('guest-name-input').value = '';
                    document.getElementById('guest-phone-input').value = '';

                } catch (e) {
                    console.error("Error guardando invitado:", e);
                    alert("Hubo un error guardando en la nube.");
                }
            } else {
                alert("Conectando con la base de datos... intenta de nuevo en unos segundos.");
                return;
            }
        };

        // BORRAR DE FIREBASE (CLOUD)
        window.deleteGuest = async function(docId) {
            if(confirm('¿Estás seguro de eliminar a este invitado? Esta acción no se puede deshacer.')) {
                try {
                    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'invitaciones_boda_guests', docId));
                    // La lista se actualizará sola gracias a onSnapshot
                } catch (e) {
                    console.error("Error borrando:", e);
                    alert("Error al borrar. Verifica tu conexión.");
                }
            }
        };

        // Renderizar Lista (Desde memoria sincronizada)
        window.renderGuestList = function() {
            const tbody = document.getElementById('guest-list-body');
            const emptyState = document.getElementById('empty-state');
            const totalGuestsEl = document.getElementById('total-guests');
            const totalPaxEl = document.getElementById('total-pax');

            tbody.innerHTML = '';
            totalGuestsEl.innerText = guestList.length;
            const totalPax = guestList.reduce((sum, g) => sum + parseInt(g.tickets || 0), 0);
            totalPaxEl.innerText = totalPax;

            if (guestList.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            } else {
                emptyState.classList.add('hidden');
            }

            guestList.forEach((guest) => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-white transition-colors border-b border-gray-100 last:border-0";
                // Usamos el ID de Firestore para borrar
                tr.innerHTML = `
                    <td class="p-2 font-medium text-gray-700">
                        ${guest.name}<br>
                        <span class="text-[10px] text-gray-400">${guest.phone}</span>
                    </td>
                    <td class="p-2 text-center text-gray-600 font-bold">${guest.tickets}</td>
                    <td class="p-2 text-right">
                        <button onclick="deleteGuest('${guest.id}')" class="text-red-400 hover:text-red-600 p-1 transition-colors" title="Eliminar">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        };

        // EXPORTAR (Usa la lista local sincronizada)
        window.exportToExcel = function() {
            if (guestList.length === 0) { alert("No hay datos para exportar"); return; }
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Nombre del Invitado,Boletos,Telefono,Fecha Registro\n";
            guestList.forEach(g => {
                csvContent += `"${g.name}",${g.tickets},"${g.phone}",${g.date}\n`;
            });
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "lista_invitados_boda.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };

        window.exportToWord = function() {
            if (guestList.length === 0) { alert("No hay datos para exportar"); return; }
            const totalPax = guestList.reduce((sum, g) => sum + parseInt(g.tickets || 0), 0);
            let htmlContent = `
                <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
                <head><meta charset='utf-8'><title>Lista de Invitados</title></head>
                <body>
                    <h2 style="text-align:center; font-family:Arial;">Lista de Invitados - Boda Ana & Carlos</h2>
                    <p style="text-align:center;"><strong>Total Invitaciones:</strong> ${guestList.length} | <strong>Total Personas:</strong> ${totalPax}</p>
                    <table border="1" cellpadding="5" cellspacing="0" style="width:100%; border-collapse:collapse; font-family:Arial; font-size:12px;">
                        <tr style="background-color:#eee;">
                            <th>Nombre</th>
                            <th>Pases</th>
                            <th>Teléfono</th>
                            <th>Fecha</th>
                        </tr>
            `;
            guestList.forEach(g => {
                htmlContent += `<tr><td>${g.name}</td><td style="text-align:center;">${g.tickets}</td><td>${g.phone}</td><td>${g.date}</td></tr>`;
            });
            htmlContent += "</table></body></html>";
            const blob = new Blob([htmlContent], { type: 'application/msword' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "lista_invitados_boda.doc";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };

        // --- INICIALIZACIÓN ---
        document.addEventListener('DOMContentLoaded', () => {
            window.startTimer();
            window.initScrollObserver();
            window.setupSecretAccess(); // Activar el modo de 5 clicks

            // Bind click events
            const envelope = document.getElementById('envelope');
            if (envelope) envelope.addEventListener('click', window.openEnvelope);
            
            const musicToggle = document.getElementById('musicToggle');
            if (musicToggle) musicToggle.addEventListener('click', window.toggleMusic);
            
            const closeAdmin = document.getElementById('closeAdmin');
            if (closeAdmin) closeAdmin.addEventListener('click', () => window.toggleAdmin(false));
        });

    </script>
</body>
</html>